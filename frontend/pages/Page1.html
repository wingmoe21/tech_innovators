<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="{{ url_for('static', filename='globalsPage1.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='stylePage1.css') }}">
  </head>
  <body>
    <div class="chat">
      <div class="overlap-wrapper">
        <div class="overlap">
          <div class="ellipse"></div>
          <div class="div"></div>
          <div class="ellipse-2"></div>
          <div class="ellipse-3"></div>
          <div class="rectangle"></div>
          <div class="rectangle-2"></div>
          <div class="lectures-rectangle">
            <select class="lectures-dropdown" id="lecturesDropdown" onchange="updateSelectedLecture()">
              <option value="" disabled selected>Select your option</option>
              <option value="lecture1">Lecture 1</option>
              <option value="lecture2">Lecture 2</option>
              <option value="lecture3">Lecture 3</option>
                <!-- Add more options as needed -->
            </select>
            <div class="text-wrapper-2">
              <span id="lecturesLabel">Choose a Lecture...</span>
              <span id="selectedLecture" style="display: none;"></span> <!-- Initially hidden -->
            </div>
            <img class="polygon" src="{{ url_for('static', filename='img/polygon-1.svg') }}" />
          </div>
          <div class="rectangle-3">
            <div id="chat-messages-container">
              <!-- Chat messages will be dynamically added here -->
          </div>
          </div>
          <div class="message-rectangle">
            <form id="chat-form">
              <input type="text" id="chat-input" placeholder="Type your message here..." autocomplete="off">
            </form>
          </div>
          <img class="iconly-bulk-send" src="{{ url_for('static', filename='img/iconly-bulk-send.png') }}" onclick="submitChatForm()"/>
          <img class="fill" src="{{ url_for('static', filename='img/fill-4.svg') }}" />
          <!-- Chatbot Button -->
          <a href="{{ url_for('chat') }}" class="button-link">
            <div class="rectangle-6"></div>
            <div class="text-wrapper-4">CHATBOT</div>
          </a>
          <!-- Summary Button -->
          <a href="{{ url_for('summary') }}" class="button-link">
            <div class="rectangle-7"></div>
            <div class="text-wrapper-5">SUMMARY</div>
          </a>
          <!-- Quiz Button -->
          <a href="{{ url_for('quiz') }}" class="button-link">
            <div class="rectangle-8"></div>
            <div class="text-wrapper-6">QUIZ</div>
          </a>
          <img class="group-2" src="{{ url_for('static', filename='img/group.png') }}" />
          <div class="overlap-group-wrapper">
            <div class="ellipse-wrapper"><div class="ellipse-5"></div></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function updateSelectedLecture() {
        var dropdown = document.getElementById("lecturesDropdown");
        var selectedText = dropdown.options[dropdown.selectedIndex].text;
        var label = document.getElementById("lecturesLabel");
        var selectedLectureSpan = document.getElementById("selectedLecture");
        // If the selected option is not the placeholder
        if(dropdown.selectedIndex > 0) {
          label.style.display = "none"; // Hide the "LECTURES" text
          selectedLectureSpan.textContent = selectedText; // Set the selected text
          selectedLectureSpan.style.display = "block"; // Show the selected text
        } else {
          label.style.display = "block"; // Show the "LECTURES" text
          selectedLectureSpan.style.display = "none"; // Hide the selected text
        }
      }
      function displayMessage(message, sender) {
        var chatMessagesContainer = document.getElementById('chat-messages-container');
        var messageElement = document.createElement('div');
        messageElement.textContent = message;
        messageElement.classList.add('chat-message');
        
        if (sender === 'user') {
          messageElement.classList.add('user-message');
        } else {
          messageElement.classList.add('bot-message');
        }
        
        chatMessagesContainer.appendChild(messageElement);
        // Scroll to the bottom of the chat container to show the latest message
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
      }
      function submitChatForm() {
        var event = new Event('submit');
        document.getElementById('chat-form').dispatchEvent(event);
      }
        
        document.getElementById('chat-form').addEventListener('submit', function(event) {
          event.preventDefault();
          var userInput = document.getElementById('chat-input').value;
          
          if (userInput.trim() !== '') {
      displayMessage(userInput, 'user'); // Display user message on the front end
      document.getElementById('chat-input').value = ''; // Clear the input right after sending the message
      
      fetch('/chatbot', {
        method: 'POST',
        body: JSON.stringify({ message: userInput }),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        displayMessage(data.reply, 'bot'); // Display bot message on the front end
      })
      .catch(error => console.error('Error:', error));
    }
  });
  </script>
  </body>
  </html>
  
  